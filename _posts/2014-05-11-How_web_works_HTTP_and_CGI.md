---
layout: post
title: "Web是如何运行的: HTTP 和 CGI"
description: "description"
categories: ["网络编程","翻译"]
tags: ["HTTP","CGI","what does the browser do"]
published: true
---
{% include JB/setup %} 

本文翻译自[How the web works: HTTP and CGI explained][1] ，这篇翻译是按自己的理解进行翻译并不一定字字对应，如有需要请参考原文。

#介绍

##关于本文

这篇文章是为了让读者对web是如何工作的有一个基本的了解，写作这篇文章的原因是因为在不同的新闻组看到了人们想要了解这些但是却不知道从何去了解这些知识，所以我把收集到的资料整理成了这篇文章。

这篇文章涵盖了HTTP协议，一个用来传输网页的协议；还涉及到了服务器相关的知识和一些脚本技术。这篇文章假定读者基本了解一些网页知识，了解HTML和URLs.(一个连接就是一个文件的地址，你的要求就是要取得这个文件)


##一些背景

当你浏览网页时的情况基本上是这样的：你坐在你的电脑前，并希望看到在网络上某个地方的一个文档，而你有这个文档的URL。

既然你要读取的文件是在世界的其他地方，可能相距很远，所以你需要提供一些更多的细节，以便你可以得到这个文件。

第一个要告知浏览器的细节是这个文件的URL。你启动它，键入URL（至少你在某种程度上告诉浏览器你想去的地方，也许是通过点击一个链接）。

然而，画面依然没有完成，因为浏览器不能直接从存储这个文件的磁盘读取，这个磁盘在其他计算机上，而且如果这个计算机在其他大陆呢？所以，如果你要读取这个文件，那么存储这个文件的计算机必须运行一个Web服务器程序。一个web服务器是一个监听来自浏览器的请求，然后执行他们的计算机程序。

那么接下来发生的事情是：浏览器与服务器联系并请求服务器传送文件给它。然后，服务器将包含文档的响应发送给浏览器，浏览器愉快的把它显示出来给用户（你）看。而且服务器还告诉浏览器这个文件是什么样的文件，是（HTML文件、PDF文件还是ZIP文件等），然后浏览器根据它的配置，使用和该类型文档对应的程序显示出来。

浏览器会直接显示HTML文档，如果HTML文档它包含指向图像，Java小程序，声音剪辑等的内容，浏览器也会从它们所在的服务器请求这些文件(图像，Java小程序，声音剪辑等,这些文件通常在同一台服务器，但并不总是)。值得一提的是，这将是单独的请求，并给服务器和网络添加额外的负载。当用户点击另一个连接的时整个序列就又重新开始了。

这些请求和响应是使用一个叫HTTP的特殊语言作出的，HTTP是超文本传输协议HyperText Transfer Protocol的缩写。这篇文章基本上就是介绍它具体是如何工作的。其他类似比较常见的协议有FTP和Gopher(译注：文章是99年的，Gopher这个协议已经不常见了)，还有那些工作方式完全不同的协议，本文都不会涉及到，可以参考其他文章。

值得一提的是，HTTP只定义了浏览器和Web服务器互相说什么内容，但没有定义他们怎么交流，也就是没有定义怎么把说的内容发送给对方。跨越网络传输比特和字节的实际工作是由 TCP和IP协议实现的，也就是说TCP/IP定义具体怎么把内容传输给对方，大多数其他互联网协议如(FTP,Gopher)也是依赖于TCP/IP实现传输的。

当你继续往下阅读的时候请注意，任何做和网页浏览器一样工作（如：从服务器检索文档）的**软件程序**在不同场合下被称为**客户端(Client)** 或者 **用户代理(User Agent)**。还要注意的是，**服务器(server)**应该指的是**服务器程序(server program)**，而不是在其上运行一个服务器应用程序的计算机(server machine)。

#当我点击一个链接，会发生什么？

##步骤1：解析URL

首先，浏览器所要做的就是要查看新文档的URL，看如何取得这个文档。大多数URL有这样的基本形式：

    protocol://server/request-URI      协议://服务器/请求的URI
    
    http://haiyangxu.github.io/about.html
    

 - **protocol :** 告诉浏览器如何检索服务器；
 - **server :** 告诉浏览器服务器的地址，就是告诉了浏览器去哪里连接服务器；
 - **request-URI :** 是Web服务器用来确定该文件的名称。

##第2步：发送请求

通常，协议是“http”的。通过HTTP检索文档的浏览器发送以下请求到服务器：

    GET /request-URI HTTP/version
    
其中version告诉服务器用HTTP哪个版本。（通常情况下，浏览器还有更多的一些信息，后面会进行详细描述。）

这里很重要的一点是，这个请求字符串是服务器看到的所有东西。因此服务器并不关心，请求是来自一个浏览器、一个链接检查程序、搜索引擎爬虫或者是你在手动键入这个请求字符串。服务器只是执行请求，并返回结果。

##第3步：服务器响应

当服务器接收到HTTP请求，并找到适当的文档就返回它。然而，HTTP响应被要求具有特定的形式。它必须看起来像这样：

    HTTP/[VER] [CODE] [TEXT]
    Field1: Value1
    Field2: Value2
    
    ...Document content here...

第一行显示了所使用的HTTP版本，随后是3位数字（HTTP状态代码）和可以给人看的对应于状态码的短语。通常情况下[code] 和[TEXT]为`200 OK`,这意味着一切运行良好。第一行后面跟着一些所谓的header，包含关于文档的信息。用一个空行结束header，然后后面就跟着文档的内容。下面是一个典型的header：

    HTTP/1.0 200 OK
    Server: Netscape-Communications/1.1
    Date: Tuesday, 25-Nov-97 01:22:04 GMT
    Last-modified: Thursday, 20-Nov-97 10:44:53 GMT
    Content-length: 6372
    Content-type: text/html
    
    <!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">
    <HTML>
    ...followed by document content...
    
我们从这个响应头可以的第一行看到，请求成功了。第二行是可选的，并且告诉我们，在服务器运行的Web服务器是Netscape-Communications，1.1版。然后，我们得到了什么服务器当前的日期和文件的最后修改时间，然后是文件的字节大小，最后，最重要的字段是：Content-type。

内容类型(Content-type)字段被浏览器用来判断接收到的文件格式，HTML文件格式是被定义为`text/html`，`text/plain`为普通文本，GIF是`image/gif`等。这样做的优点是，该URL可以具有任意的结尾而浏览器将仍然能得到文档的正确格式并正确解析。

这里有一个重要的概念是，对于浏览器，服务器可以作为一个黑盒子。即：浏览器请求一个特定的文件，服务器要么是正确返回文件或者返回一个错误消息。服务器如何产生文档对浏览器来说仍然是未知的。这意味着服务器程序可以从一个文件中读取、运行一个程序生成，通过分析一些命令配置编译等种种方式生成这个文档。这使服务器管理员有很大的自由尝试各种不同的服务，因为用户不关心（甚至不知道）他看的的页面是如何生成的。

##服务器做了什么

当服务器被配置好的时候，它通常被配置到磁盘上的某个地方使用一个目录作为其根目录，并且每个目录会有一个默认的文件名（例如index.html）。这意味着，如果你向服务器请求文件“/”（如http://www.domain.tld/），你会获得在服务器根目录下的index.html文件。通常情况下，请求`/foo/bar.html`，服务器会给你服务器根目录下的foo的目录中的bar.html文件。

通常情况下，是那样。但是也可以将服务器的`/foo/`映射到其他磁盘或者其他目录上，甚至可以使用服务器端程序来回答对这个目录中的所有请求。服务器甚至可以完全不映射请求到一个目录结构，而可以使用一些其他的方案。


[本文是翻译的第一部分]

  [1]: http://www.garshol.priv.no/download/text/http-tut.html